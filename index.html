<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>™Rk VIP HACK - AI NEXT-GEN</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00f2ff;
            --secondary: #7000ff;
            --accent: #ff00c8;
            --bg: #050505;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --big-color: #00d2ff;
            --small-color: #ffd700;
        }

        /* টেলিগ্রাম থিম কালার অ্যাডাপ্টেশন */
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(112, 0, 255, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 242, 255, 0.15) 0%, transparent 40%);
            color: #fff; margin: 0; padding: 10px; overflow-x: hidden; min-height: 100vh;
        }

        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
            opacity: 0.2; z-index: -1;
        }

        .password-page { display: flex; justify-content: center; align-items: center; height: 100vh; }
        .password-container { 
            background: rgba(10, 10, 10, 0.8); padding: 40px; border-radius: 30px; 
            width: 320px; text-align: center; border: 2px solid var(--primary);
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.3); backdrop-filter: blur(15px);
        }
        .profile-img { width: 90px; height: 90px; border-radius: 50%; margin-bottom: 20px; border: 3px solid var(--primary); box-shadow: 0 0 20px var(--primary); }
        .password-input { padding: 15px; width: 100%; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05); color: #fff; margin-bottom: 20px; text-align: center; outline: none; box-sizing: border-box; font-size: 16px; }
        .login-btn { background: linear-gradient(45deg, var(--primary), var(--secondary)); color: #000; border: none; padding: 12px 40px; cursor: pointer; border-radius: 50px; font-weight: 900; letter-spacing: 1px; transition: 0.4s; box-shadow: 0 5px 15px rgba(0, 242, 255, 0.4); }

        .main-content { display: none; max-width: 500px; margin: 0 auto; }
        .header-title { font-family: 'Orbitron', sans-serif; font-size: 1.2rem; background: linear-gradient(to right, #fff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 20px 0; text-shadow: 0 0 10px rgba(0, 242, 255, 0.5); }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { background: var(--glass); backdrop-filter: blur(10px); padding: 15px; border-radius: 18px; border: 1px solid var(--glass-border); position: relative; overflow: hidden; }
        .stat-val { font-size: 24px; font-weight: 900; font-family: 'Orbitron'; }

        .card { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 24px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .period-box { background: rgba(0, 242, 255, 0.05); padding: 15px; border-radius: 15px; border-left: 4px solid var(--primary); margin-bottom: 15px; }
        #currentPeriod { font-family: 'Orbitron'; font-size: 1.2rem; color: var(--primary); letter-spacing: 2px; }

        .prediction-btn { font-size: 32px; font-weight: 900; margin-top: 20px; font-family: 'Orbitron'; letter-spacing: 3px; text-shadow: 0 0 15px var(--primary); }
        
        .live-badge { display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 12px; color: #00ff88; margin-bottom: 20px; font-weight: bold; text-transform: uppercase; }
        .dot-blink { height: 8px; width: 8px; background-color: #00ff88; border-radius: 50%; display: inline-block; animation: blink 1s infinite; box-shadow: 0 0 10px #00ff88; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        .step-box { background: rgba(0,0,0,0.3); border-radius: 20px; padding: 20px; border: 1px solid var(--glass-border); }
        #budgetInput { background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--primary); padding: 10px; border-radius: 10px; width: 60%; font-weight: bold; font-size: 16px; }
        .set-btn { padding: 10px 20px; background: var(--primary); color: #000; border: none; border-radius: 10px; font-weight: 900; cursor: pointer; margin-left: 5px; }

        .progress-bar { height: 12px; background: rgba(255,255,255,0.05); border-radius: 50px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); width: 0%; transition: 1s cubic-bezier(0.17, 0.67, 0.83, 0.67); }

        .tab-container { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 12px; border: 1px solid var(--glass-border); background: var(--glass); color: #888; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: #000; border-color: var(--primary); box-shadow: 0 0 15px var(--primary); }

        .history-wrapper { max-height: 500px; overflow-y: auto; border-radius: 15px; scrollbar-width: thin; scrollbar-color: var(--primary) transparent; }
        .history-wrapper::-webkit-scrollbar { width: 4px; }
        .history-wrapper::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }

        table { width: 100%; border-collapse: collapse; }
        th { background: rgba(255,255,255,0.05); padding: 12px; font-size: 11px; color: var(--primary); text-transform: uppercase; text-align: left; position: sticky; top: 0; z-index: 10; backdrop-filter: blur(5px); }
        td { padding: 15px 10px; border-bottom: 1px solid var(--glass-border); font-size: 13px; font-weight: 600; text-align: left; }
        
        .res-dot { height: 12px; width: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .dot-big { background: var(--big-color); box-shadow: 0 0 10px var(--big-color); }
        .dot-small { background: var(--small-color); box-shadow: 0 0 10px var(--small-color); }
        
        .status-win { color: #00ff88; }
        .status-loss { color: #ff3366; }
        .num-green { color: #00ff88; } .num-red { color: #ff3366; } .num-violet { color: #cc66ff; }
        .text-big { color: var(--big-color); } .text-small { color: var(--small-color); }

        @keyframes pulse-glow { from { text-shadow: 0 0 10px var(--primary); } to { text-shadow: 0 0 25px var(--primary), 0 0 40px var(--accent); } }
        .rgb-active { animation: pulse-glow 1s infinite alternate; }
        .history-section { display: none; }
        .history-section.active { display: block; }
    </style>
</head>
<body>

<div class="password-page" id="passwordPage">
    <div class="password-container">
        <img src="https://firebasestorage.googleapis.com/v0/b/topup1971-44804.appspot.com/o/image_url%2F35826.jpg?alt=media&token=b7b6ab4e-31fc-4730-b6ad-bb3943f62e8c" alt="Profile" class="profile-img">
        <h3 style="color: var(--primary); margin: 0 0 20px 0; font-family: 'Orbitron'; font-size: 14px;">AI SYSTEM ACCESS</h3>
        <input type="password" class="password-input" id="passwordInput" placeholder="ACCESS KEY">
        <button class="login-btn" onclick="checkPassword()">INITIALIZE AI</button>
        <p id="errorMsg" style="color: var(--accent); font-size: 12px; margin-top: 15px; display: none; font-weight: bold;">INVALID KEY</p>
    </div>
</div>

<div class="main-content" id="mainContent">
    <center>
        <div class="header-title">RK DEVIN QUANTUM AI v4.0</div>
        <div style="font-size: 10px; color: var(--primary); letter-spacing: 3px; margin-top: -15px; margin-bottom: 20px;">NEURAL NETWORK ACTIVE</div>
    </center>

    <div class="stats-grid">
        <div class="stat-card">
            <div style="color: #00ff88; font-size: 10px; font-weight: bold; text-transform: uppercase;">Profit Cycles</div>
            <div class="stat-val" id="totalWins" style="color: #00ff88;">0</div>
        </div>
        <div class="stat-card">
            <div style="color: var(--accent); font-size: 10px; font-weight: bold; text-transform: uppercase;">Loss Cycles</div>
            <div class="stat-val" id="totalLosses" style="color: var(--accent);">0</div>
        </div>
    </div>

    <div class="card">
        <div class="period-box">
            <div style="font-size: 10px; color: #888; font-weight: 900; margin-bottom: 5px;">TARGET PERIOD</div>
            <div id="currentPeriod">SYNCING...</div>
        </div>
        
        <div id="liveTimer" style="font-family: 'Orbitron'; color: var(--accent); font-size: 18px; margin-bottom: 5px;">00:30</div>
        
        <div class="prediction-btn" id="predictionResult">READY</div>
        
        <div class="live-badge">
            <span class="dot-blink"></span> Server Live
        </div>
        
        <div class="step-box">
            <div class="budget-container" id="budgetControl">
                <input type="number" id="budgetInput" placeholder="TOTAL BUDGET">
                <button class="set-btn" onclick="lockBudget()">LOCK</button>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                <div class="bet-text" style="color: #888; font-size: 12px;">Step: <span id="stepVal" style="color: var(--primary); font-size: 16px;">1</span></div>
                <div class="bet-text" style="color: #888; font-size: 12px;">Trade: <span id="betAmt" style="color: var(--small-color); font-size: 16px;">0</span> TK</div>
            </div>
            <div class="req-balance-anim" id="balanceReq" style="font-size: 11px; margin-top: 10px; color: var(--primary); opacity: 0.8;">Required: 0 TK</div>
        </div>
        
        <div style="display: flex; justify-content: space-between; margin-top: 20px; font-size: 10px; color: #666;">
            <span>CORE STATUS: SECURE</span>
            <span id="confidenceText">CONFIDENCE: 0%</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="confidenceBar"></div>
        </div>
    </div>

    <div class="tab-container">
        <button class="tab-btn active" onclick="switchTab('predictionTab', this)">AI PREDICTIONS</button>
        <button class="tab-btn" onclick="switchTab('gameTab', this)">MARKET HISTORY</button>
    </div>

    <div id="predictionTab" class="card history-section active" style="padding: 10px;">
        <div class="history-wrapper">
            <table>
                <thead><tr><th>PERIOD</th><th>PRED.</th><th>RESULT</th><th>STATUS</th></tr></thead>
                <tbody id="historyBody"></tbody>
            </table>
        </div>
    </div>

    <div id="gameTab" class="card history-section" style="padding: 10px;">
        <h4 style="font-size: 10px; color: var(--primary); margin: 5px 0 15px 5px;">MARKET HISTORY (LAST 100)</h4>
        <div class="history-wrapper">
             <table>
                <thead><tr><th>PERIOD</th><th>NUM</th><th>SIZE</th><th>COLOR</th></tr></thead>
                <tbody id="realHistoryBody"></tbody>
            </table>
        </div>
    </div>
    
    <div style="padding-bottom: 30px;"></div>
</div>

<script>
    // --- TELEGRAM WEB APP LOGIC ---
    const tele = window.Telegram.WebApp;
    tele.ready();
    tele.expand(); // অ্যাপটি ওপেন হওয়ার সাথে সাথেই বড় হয়ে যাবে
    // ------------------------------

    const HISTORY_API = 'https://draw.ar-lottery01.com/WinGo/WinGo_30S/GetHistoryIssuePage.json';
    const chartData = { "0/1":"BIG", "1/1":"SMALL", "2/1":"BIG", "3/1":"BIG", "4/1":"BIG", "5/1":"BIG", "6/1":"SMALL", "7/1":"BIG", "8/1":"SMALL", "9/1":"SMALL", "0/2":"SMALL", "1/2":"SMALL", "2/2":"BIG", "3/2":"BIG", "4/2":"BIG", "5/2":"SMALL", "6/2":"SMALL", "7/2":"BIG", "8/2":"BIG", "9/2":"SMALL", "0/3":"BIG", "1/3":"SMALL", "2/3":"BIG", "3/3":"BIG", "4/3":"BIG", "5/3":"SMALL", "6/3":"BIG", "7/3":"SMALL", "8/3":"BIG", "9/3":"BIG", "0/4":"SMALL", "1/4":"BIG", "2/4":"SMALL", "3/4":"SMALL", "4/4":"SMALL", "5/4":"BIG", "6/4":"SMALL", "7/4":"SMALL", "8/4":"BIG", "9/4":"BIG", "0/5":"SMALL", "1/5":"SMALL", "2/5":"BIG", "3/5":"SMALL", "4/5":"BIG", "5/5":"SMALL", "6/5":"BIG", "7/5":"BIG", "8/5":"BIG", "9/5":"BIG", "0/6":"BIG", "1/6":"BIG", "2/6":"SMALL", "3/6":"SMALL", "4/6":"SMALL", "5/6":"SMALL", "6/6":"BIG", "7/6":"BIG", "8/6":"SMALL", "9/6":"BIG", "0/7":"SMALL", "1/7":"BIG", "2/7":"BIG", "3/7":"BIG", "4/7":"BIG", "5/7":"SMALL", "6/7":"SMALL", "7/7":"BIG", "8/7":"BIG", "9/7":"SMALL", "0/8":"SMALL", "1/8":"SMALL", "2/8":"SMALL", "3/8":"SMALL", "4/8":"SMALL", "5/8":"BIG", "6/8":"SMALL", "7/8":"SMALL", "8/8":"BIG", "9/8":"BIG", "0/9":"BIG", "1/9":"SMALL", "2/9":"SMALL", "3/9":"SMALL", "4/9":"SMALL", "5/9":"BIG", "6/9":"SMALL", "7/9":"SMALL", "8/9":"SMALL", "9/9":"SMALL", "0/0":"BIG", "1/0":"BIG", "2/0":"SMALL", "3/0":"BIG", "4/0":"BIG", "5/0":"SMALL", "6/0":"BIG", "7/0":"BIG", "8/0":"SMALL", "9/0":"SMALL" };

    const MULTIPLIER = 1.96;
    let autoSelectedNumbers = [];
    let currentFullPeriod = "";
    let predictionHistory = [];
    let totalWinCount = 0;
    let totalLossCount = 0;
    let currentStep = 1;
    let hasAnalyzedThisPeriod = false;
    let userBudget = 0;
    let stepAmounts = [];
    let totalRequiredBalance = 0;

    function lockBudget() {
        const input = document.getElementById('budgetInput');
        const budgetVal = parseFloat(input.value);
        if (budgetVal > 0) {
            userBudget = budgetVal;
            generateStepStrategy(7, userBudget);
            document.getElementById('budgetControl').innerHTML = `<span style="color:var(--primary); font-weight:900;">BUDGET LOCKED: ${userBudget} TK</span>`;
            updateStepDisplay();
            // টেলিগ্রামে ভাইব্রেশন ফিডব্যাক (অপশনাল)
            if(tele.HapticFeedback) tele.HapticFeedback.notificationOccurred('success');
        } else { alert("Enter Valid Amount!"); }
    }

    function generateStepStrategy(steps, budget) {
        let currentRatioCost = 0;
        for(let i=1; i<=steps; i++) {
            let betRatio = (currentRatioCost + 1) / (MULTIPLIER - 1);
            currentRatioCost += betRatio;
        }
        let targetProfitPerStep = budget / currentRatioCost;
        let totalCost = 0;
        stepAmounts = [];
        for (let i = 1; i <= steps; i++) {
            let bet = (totalCost + targetProfitPerStep) / (MULTIPLIER - 1);
            bet = Math.ceil(bet); totalCost += bet; stepAmounts.push(bet);
        }
        totalRequiredBalance = totalCost;
        document.getElementById('balanceReq').innerText = `Required Balance: ${totalRequiredBalance} TK`;
    }

    function updateStepDisplay() {
        if (stepAmounts.length === 0) return;
        let amount = stepAmounts[currentStep - 1] || stepAmounts[0];
        document.getElementById('stepVal').innerText = currentStep;
        document.getElementById('betAmt').innerText = amount;
    }

    function checkPassword() {
        if(document.getElementById('passwordInput').value === "99") {
            document.getElementById('passwordPage').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            updateData(); 
            if(tele.HapticFeedback) tele.HapticFeedback.impactOccurred('medium');
        } else { 
            document.getElementById('errorMsg').style.display = 'block'; 
            if(tele.HapticFeedback) tele.HapticFeedback.notificationOccurred('error');
        }
    }

    function formatPeriod17(apiIssue) {
        const now = new Date();
        const y = now.getFullYear();
        const m = String(now.getMonth() + 1).padStart(2, '0');
        const d = String(now.getDate()).padStart(2, '0');
        return `${y}${m}${d}1000` + apiIssue.slice(-5);
    }

    function performAutoAnalysis() {
        if(autoSelectedNumbers.length < 2 || hasAnalyzedThisPeriod) return;
        hasAnalyzedThisPeriod = true;
        const resultDisplay = document.getElementById('predictionResult');
        resultDisplay.innerText = "SCANNING...";
        
        setTimeout(() => {
            const key = `${autoSelectedNumbers[0]}/${autoSelectedNumbers[1]}`;
            const prediction = chartData[key] || "BIG";
            const confidence = Math.floor(Math.random() * (99 - 94 + 1)) + 94;
            resultDisplay.innerText = prediction;
            resultDisplay.classList.add('rgb-active');
            updateStepDisplay();
            document.getElementById('confidenceText').innerText = "CONFIDENCE: " + confidence + "%";
            document.getElementById('confidenceBar').style.width = confidence + "%";
            
            if(!predictionHistory.find(p => p.period === currentFullPeriod)) {
                predictionHistory.unshift({ period: currentFullPeriod, prediction: prediction, actual: "-", status: "Pending", step: currentStep });
                renderMyTable();
            }
        }, 1500); 
    }

    async function updateData() {
        const now = new Date();
        const seconds = now.getSeconds();
        let remaining = 30 - (seconds % 30);
        document.getElementById('liveTimer').innerText = (remaining < 10 ? "00:0" : "00:") + remaining;

        try {
            const res = await fetch(`${HISTORY_API}?pageSize=100&pageNo=1&type=1&ts=${Date.now()}`);
            const data = await res.json();
            const apiList = data.data.list;

            if(apiList.length > 0) {
                const latestApiIssue = apiList[0].issueNumber;
                const nextApiIssue = String(BigInt(latestApiIssue) + 1n);
                const newFullPeriod = formatPeriod17(nextApiIssue);

                if (newFullPeriod !== currentFullPeriod) {
                    currentFullPeriod = newFullPeriod;
                    hasAnalyzedThisPeriod = false; 
                    document.getElementById('currentPeriod').innerText = currentFullPeriod;
                    document.getElementById('predictionResult').innerText = "CALCULATING";
                    document.getElementById('predictionResult').classList.remove('rgb-active');
                    document.getElementById('confidenceBar').style.width = "0%";
                }

                if(apiList.length >= 2) {
                    autoSelectedNumbers = [parseInt(apiList[0].number), parseInt(apiList[1].number)];
                    if(!hasAnalyzedThisPeriod && remaining > 3) { performAutoAnalysis(); }
                }

                document.getElementById('realHistoryBody').innerHTML = apiList.slice(0, 100).map(item => {
                    const n = parseInt(item.number);
                    const color = [1,3,7,9].includes(n) ? "Green" : ([2,4,6,8].includes(n) ? "Red" : "Violet");
                    const size = n >= 5 ? "BIG" : "SMALL";
                    return `<tr><td>${item.issueNumber.slice(-5)}</td><td class="num-${color.toLowerCase()}">${n}</td><td>${size}</td><td class="num-${color.toLowerCase()}">${color}</td></tr>`;
                }).join('');

                predictionHistory.forEach(item => {
                    if (item.status === "Pending") {
                        const match = apiList.find(h => h.issueNumber.slice(-5) === item.period.slice(-5));
                        if (match) {
                            item.actual = parseInt(match.number) >= 5 ? "BIG" : "SMALL";
                            if (item.prediction === item.actual) {
                                item.status = "WIN"; totalWinCount++; currentStep = 1; 
                            } else {
                                item.status = "LOSS"; totalLossCount++; currentStep = currentStep < 7 ? currentStep + 1 : 1;
                            }
                            document.getElementById('totalWins').innerText = totalWinCount;
                            document.getElementById('totalLosses').innerText = totalLossCount;
                            updateStepDisplay(); renderMyTable();
                        }
                    }
                });
            }
        } catch (e) {}
    }

    function renderMyTable() {
        document.getElementById('historyBody').innerHTML = predictionHistory.map(item => {
            const predClass = item.prediction === "BIG" ? "text-big" : "text-small";
            const actualDot = item.actual === "BIG" ? "dot-big" : (item.actual === "SMALL" ? "dot-small" : "");
            const actualClass = item.actual === "BIG" ? "text-big" : (item.actual === "SMALL" ? "text-small" : "");
            return `<tr>
                <td style="color:#666;">...${item.period.slice(-5)}</td>
                <td class="${predClass}">${item.prediction} <span style="font-size:9px; color:#444;">(S${item.step})</span></td>
                <td>${item.actual !== "-" ? `<span class="res-dot ${actualDot}"></span>` : ""}<span class="${actualClass}">${item.actual === "-" ? "..." : item.actual}</span></td>
                <td class="status-${item.status.toLowerCase()}">${item.status}</td>
            </tr>`;
        }).join('');
    }

    function switchTab(id, b) {
        document.querySelectorAll('.history-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        b.classList.add('active');
    }

    setInterval(updateData, 1000);
    updateData();
</script>
</body>
</html>